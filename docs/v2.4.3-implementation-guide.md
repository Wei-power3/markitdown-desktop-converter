# v2.4.3 Implementation Guide

## üéØ Quick Start - What's Done

‚úÖ **Phase 1 Complete!** (30 minutes)

We've successfully created the foundation:
- Excel converter with multi-sheet support
- XML helper utilities
- Base64 encoding utilities

All utilities are ready for PPTX processing!

---

## üì¶ Files Created

### 1. Excel Converter
**File:** [`web/js/converters/excel-v243.js`](../web/js/converters/excel-v243.js)

```javascript
// Usage example:
const converter = new ExcelConverterV243();
const result = await converter.convert(excelFile);
console.log(result.markdown);
console.log(result.stats); // { totalSheets, formulas, mergedCells, ... }
```

**Features:**
- ‚úÖ Multi-sheet processing
- ‚úÖ Formula preservation as `` `=FORMULA()` ``
- ‚úÖ Merged cell detection
- ‚úÖ Empty cell handling
- ‚úÖ Document summary generation

### 2. XML Helper
**File:** [`web/js/utils/xml-helper.js`](../web/js/utils/xml-helper.js)

```javascript
// Usage example:
const xmlDoc = XMLHelper.parseXML(xmlString);
const text = XMLHelper.getAllTextNodes(element);
const position = XMLHelper.getShapePosition(shape);
```

**Utilities:**
- XML parsing with error handling
- Namespace-aware selectors
- Text extraction
- Attribute helpers
- Shape positioning

### 3. Base64 Helper
**File:** [`web/js/utils/base64-helper.js`](../web/js/utils/base64-helper.js)

```javascript
// Usage example:
const base64 = Base64Helper.arrayBufferToBase64(buffer);
const dataURI = Base64Helper.createDataURI(base64, 'image/png');
const size = Base64Helper.formatSize(bytes);
```

**Utilities:**
- File/ArrayBuffer to Base64
- MIME type detection
- Data URI generation
- Size formatting

---

## üõ£Ô∏è Next Steps (Phases 2-6)

### Phase 2: PPTX Image Extraction (3 hours)

Create **`web/js/modules/pptx-images.js`**

**Key functionality:**
```javascript
class PPTXImageExtractor {
    async extractAll() {
        // 1. Find all files in ppt/media/
        // 2. Extract each image to base64
        // 3. Parse slide XML for alt text
        // 4. Return array of image objects
    }
    
    async enhanceWithAltText(slideNumber) {
        // Parse slide XML
        // Find <p:cNvPr descr="..." />
        // Update image altText
    }
}
```

**Reference code from markitdown:**
```python
# From markitdown/_pptx_converter.py line 95-135
if self._is_picture(shape):
    alt_text = shape._element._nvXxPr.cNvPr.attrib.get("descr", "")
    blob = shape.image.blob
    b64_string = base64.b64encode(blob).decode("utf-8")
```

### Phase 3: Speaker Notes (1.5 hours)

Create **`web/js/modules/pptx-notes.js`**

**Key functionality:**
```javascript
class PPTXNotesExtractor {
    async extractForSlide(slideNumber) {
        // 1. Check ppt/notesSlides/notesSlide{N}.xml
        // 2. Parse XML for text nodes
        // 3. Clean and return notes text
    }
}
```

**XML structure:**
```xml
<!-- ppt/notesSlides/notesSlide1.xml -->
<p:notes>
    <p:txBody>
        <a:p>
            <a:r>
                <a:t>Speaker notes text here</a:t>
            </a:r>
        </a:p>
    </p:txBody>
</p:notes>
```

### Phase 4: Chart Extraction (3 hours)

Create **`web/js/modules/pptx-charts.js`**

**Key functionality:**
```javascript
class PPTXChartExtractor {
    async extractChart(chartPath) {
        // 1. Parse ppt/charts/chart{N}.xml
        // 2. Extract chart title
        // 3. Extract series data
        // 4. Extract categories
        // 5. Format as markdown table
    }
}
```

**XML structure:**
```xml
<!-- ppt/charts/chart1.xml -->
<c:chartSpace>
    <c:chart>
        <c:title>
            <c:tx><c:v>Chart Title</c:v></c:tx>
        </c:title>
        <c:plotArea>
            <c:barChart>
                <c:ser>
                    <c:tx><c:v>Series 1</c:v></c:tx>
                    <c:val>
                        <c:numRef>
                            <c:numCache>
                                <c:pt><c:v>100</c:v></c:pt>
                            </c:numCache>
                        </c:numRef>
                    </c:val>
                </c:ser>
            </c:barChart>
        </c:plotArea>
    </c:chart>
</c:chartSpace>
```

### Phase 5: Integration (2 hours)

Create **`web/js/converters/pptx-v243.js`**

```javascript
class PPTXConverterV243 {
    constructor(options) {
        this.options = {
            extractImages: true,
            extractCharts: true,
            includeSpeakerNotes: true,
            embedImagesAsBase64: true
        };
    }
    
    async convert(file) {
        // 1. Load PPTX with JSZip
        // 2. Initialize all extractors
        // 3. Process each slide
        // 4. Combine all content
        // 5. Return markdown + stats
    }
}
```

### Phase 6: UI Integration (2 hours)

Create **`web/index_v2.4.3.html`**

**Key changes:**
```html
<!-- Add script includes -->
<script src="js/utils/xml-helper.js"></script>
<script src="js/utils/base64-helper.js"></script>
<script src="js/modules/pptx-images.js"></script>
<script src="js/modules/pptx-charts.js"></script>
<script src="js/modules/pptx-notes.js"></script>
<script src="js/converters/excel-v243.js"></script>
<script src="js/converters/pptx-v243.js"></script>

<!-- Add options panel -->
<div class="options-panel">
    <label>
        <input type="checkbox" id="opt-embed-images" checked>
        Embed images as base64
    </label>
    <!-- More options... -->
</div>
```

**Update conversion logic:**
```javascript
if (isPPTX) {
    const converter = new PPTXConverterV243({
        extractImages: document.getElementById('opt-embed-images').checked,
        extractCharts: document.getElementById('opt-charts').checked,
        includeSpeakerNotes: document.getElementById('opt-notes').checked
    });
    result = await converter.convert(job.file);
    job.v243Stats = result.stats;
}
```

---

## üìù Testing Checklist

### Excel Testing
- [ ] Single sheet Excel file
- [ ] Multi-sheet (3+ sheets)
- [ ] File with formulas
- [ ] File with merged cells
- [ ] Empty sheets
- [ ] Large file (1000+ rows)

### PPTX Testing
- [ ] PPTX with images
- [ ] PPTX with charts
- [ ] PPTX with speaker notes
- [ ] PPTX with grouped shapes
- [ ] PPTX with all features combined
- [ ] Large PPTX (50+ slides)

---

## üöÄ Quick Deploy

When ready to deploy:

```bash
# Test locally
cd web
python -m http.server 8000
# Visit http://localhost:8000

# Commit all changes
git add web/js/
git commit -m "feat: Complete v2.4.3 implementation"

# Deploy to production
cp web/index_v2.4.3.html web/index.html
git add web/index.html
git commit -m "deploy: Release v2.4.3"
git push origin main
```

---

## üìà Success Criteria

- ‚úÖ All 6 phases complete
- ‚úÖ Excel multi-sheet works
- ‚úÖ PPTX images extracted
- ‚úÖ PPTX charts converted
- ‚úÖ Speaker notes included
- ‚úÖ All tests passing
- ‚úÖ Documentation updated
- ‚úÖ Production deployed

---

## üìö Reference Links

- **Progress Tracker:** [`docs/v2.4.3-progress.md`](./v2.4.3-progress.md)
- **MarkItDown PPTX:** [_pptx_converter.py](https://github.com/Wei-power3/markitdown/blob/main/packages/markitdown/src/markitdown/converters/_pptx_converter.py)
- **MarkItDown Excel:** [_xlsx_converter.py](https://github.com/Wei-power3/markitdown/blob/main/packages/markitdown/src/markitdown/converters/_xlsx_converter.py)
- **PPTX XML Spec:** [Microsoft Docs](https://learn.microsoft.com/en-us/openspecs/office_standards/ms-pptx/)

---

**Status:** Phase 1 ‚úÖ Complete | Ready for Phase 2  
**Next:** Create `pptx-images.js` module
